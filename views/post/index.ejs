<%- include('../components/header.ejs') %> <%-
include('../components/navbar.ejs') %>
<main>
  <section class="py-10">
    <div
      class="flex flex-col justify-center gap-10 md:flex-col lg:flex-row xl:flex-row"
    >
      <div class="max-h-screen basis-2/4">
        <%if(isAuthenticated){ %>
        <div class="mb-3 flex gap-3 bg-white px-6 py-5 shadow-mdw">
          <div class="w-full">
            <form method="POST" id="post-form">
              <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
              <textarea
                type="text"
                name="content"
                id=""
                cols="40"
                rows="3"
                class="block w-full rounded-lg border border-gray-300 bg-gray-50 p-4 ps-10 text-base text-gray-900 focus:border-blue-500 focus:ring-primary"
                placeholder="Say something"
              ></textarea>
              <span class="content-error text-sm text-red-500"></span>

              <div class="mt-3 flex justify-end gap-5">
                <button
                  type="submit"
                  class="rounded bg-blue-500 px-4 py-2 font-bold text-white hover:bg-blue-700 cursor-pointer"
                >
                  Post
                </button>
              </div>
            </form>
          </div>
        </div>
        <% } %>
        <!-- post -->
        <div class="post-container">
          <% for(let post of posts) {%>
          <div
            class="bg-white shadow-sm px-6 py-5 mt-2 post-item"
            data-post-item="<%= post.id  %>"
          >
            <article>
              <p class="post-content"><%= post.content %></p>

              <div class="flex justify-between items-center mt-2">
                <p class="text-sm text-gray-500">
                  Posted by:
                  <span class="font-semibold"><%= post.user.name %></span>
                </p>
                <%if(isAuthenticated){ %> <% if(user.id === post.userId) {%>
                <div class="space-x-2">
                  <button
                    class="text-blue-500 hover:underline cursor-pointer edit-post"
                    data-post-id="<%= post.id  %>"
                  >
                    Edit
                  </button>

                  <button
                    class="text-red-500 hover:underline cursor-pointer delete-post"
                    data-post-id="<%= post.id  %>"
                  >
                    Delete
                  </button>
                </div>
                <% } %> <% } %>
              </div>
            </article>
          </div>

          <% } %>
        </div>

        <!-- Pagination controls -->
        <div class="flex items-center justify-center gap-4 mt-6">
          <% if (pagination.hasPrevious) { %>
          <a
            href="?page=<%= pagination.currentPage - 1 %>"
            class="px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-100 transition-colors duration-200 no-underline text-gray-700"
          >
            Previous
          </a>
          <% } %>

          <div class="flex gap-2">
            <% for (let page = 1; page <= pagination.totalPages; page++) { %> <%
            if (page === pagination.currentPage) { %>
            <span
              class="px-4 py-2 border border-blue-500 bg-blue-500 text-white rounded-md cursor-default"
            >
              <%= page %>
            </span>
            <% } else { %>
            <a
              href="?page=<%= page %>"
              class="px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-100 transition-colors duration-200 no-underline text-gray-700"
            >
              <%= page %>
            </a>
            <% } %> <% } %>
          </div>

          <% if (pagination.hasNext) { %>
          <a
            href="?page=<%= pagination.currentPage + 1 %>"
            class="px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-100 transition-colors duration-200 no-underline text-gray-700"
          >
            Next
          </a>
          <% } %>
        </div>
      </div>
    </div>
  </section>
</main>
<%- include('../components/footer.ejs') %>
